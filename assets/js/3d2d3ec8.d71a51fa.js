"use strict";(self.webpackChunkreact_navigation_website_next=self.webpackChunkreact_navigation_website_next||[]).push([[33745],{11371:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>c,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"screen-tracking","title":"Screen tracking","description":"This example shows how to do screen tracking and send to Google Analytics. The approach can be adapted to any other analytics SDK.","source":"@site/versioned_docs/version-2.x/screen-tracking.md","sourceDirName":".","slug":"/screen-tracking","permalink":"/docs/2.x/screen-tracking","draft":false,"unlisted":false,"editUrl":"https://github.com/react-navigation/react-navigation.github.io/edit/main/versioned_docs/version-2.x/screen-tracking.md","tags":[],"version":"2.x","frontMatter":{"id":"screen-tracking","title":"Screen tracking","sidebar_label":"Screen tracking"},"sidebar":"version-2.x-docs","previous":{"title":"Deep linking","permalink":"/docs/2.x/deep-linking"},"next":{"title":"State persistence","permalink":"/docs/2.x/state-persistence"}}');var a=t(74848),i=t(28453);const o={id:"screen-tracking",title:"Screen tracking",sidebar_label:"Screen tracking",rawMarkdown:"---\nid: screen-tracking\ntitle: Screen tracking\nsidebar_label: Screen tracking\n---\n\nThis example shows how to do screen tracking and send to Google Analytics. The approach can be adapted to any other analytics SDK.\n\n## Listening to State Changes\n\nMost users can use `onNavigationStateChange` to track the screen. If you manually control the top-level navigator (if you have integrated redux), this will not work for you.\n\n```js\nimport { GoogleAnalyticsTracker } from 'react-native-google-analytics-bridge';\n\nconst tracker = new GoogleAnalyticsTracker(GA_TRACKING_ID);\n\n// gets the current screen from navigation state\nfunction getActiveRouteName(navigationState) {\n  if (!navigationState) {\n    return null;\n  }\n  const route = navigationState.routes[navigationState.index];\n  // dive into nested navigators\n  if (route.routes) {\n    return getActiveRouteName(route);\n  }\n  return route.routeName;\n}\n\nconst AppNavigator = createStackNavigator(AppRouteConfigs);\n\nexport default () => (\n  <AppNavigator\n    onNavigationStateChange={(prevState, currentState) => {\n      const currentScreen = getActiveRouteName(currentState);\n      const prevScreen = getActiveRouteName(prevState);\n\n      if (prevScreen !== currentScreen) {\n        // the line below uses the Google Analytics tracker\n        // change the tracker here to use other Mobile analytics SDK.\n        tracker.trackScreenView(currentScreen);\n      }\n    }}\n  />\n);\n```\n\n## Screen tracking with Redux\n\nWhen using Redux, we can write a Redux middleware to track the screen. For this purpose,\nwe will reuse `getActiveRouteName` from the previous section.\n\n```js\nimport { NavigationActions } from 'react-navigation';\nimport { GoogleAnalyticsTracker } from 'react-native-google-analytics-bridge';\n\nconst tracker = new GoogleAnalyticsTracker(GA_TRACKING_ID);\n\nconst screenTracking =\n  ({ getState }) =>\n  (next) =>\n  (action) => {\n    if (\n      action.type !== NavigationActions.NAVIGATE &&\n      action.type !== NavigationActions.BACK\n    ) {\n      return next(action);\n    }\n\n    const currentScreen = getActiveRouteName(getState().navigation);\n    const result = next(action);\n    const nextScreen = getActiveRouteName(getState().navigation);\n    if (nextScreen !== currentScreen) {\n      // the line below uses the Google Analytics tracker\n      // change the tracker here to use other Mobile analytics SDK.\n      tracker.trackScreenView(nextScreen);\n    }\n    return result;\n  };\n\nexport default screenTracking;\n```\n\n### Create Redux store and apply the above middleware\n\nThe `screenTracking` middleware can be applied to the store during its creation. See [Redux Integration](redux-integration.md) for details.\n\n```js\nconst store = createStore(\n  combineReducers({\n    navigation: navigationReducer,\n    ...\n  }),\n  applyMiddleware(\n    screenTracking,\n    ...\n    ),\n);\n```\n"},c=void 0,s={},l=[{value:"Listening to State Changes",id:"listening-to-state-changes",level:2},{value:"Screen tracking with Redux",id:"screen-tracking-with-redux",level:2},{value:"Create Redux store and apply the above middleware",id:"create-redux-store-and-apply-the-above-middleware",level:3}];function g(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"This example shows how to do screen tracking and send to Google Analytics. The approach can be adapted to any other analytics SDK."}),"\n",(0,a.jsx)(n.h2,{id:"listening-to-state-changes",children:"Listening to State Changes"}),"\n",(0,a.jsxs)(n.p,{children:["Most users can use ",(0,a.jsx)(n.code,{children:"onNavigationStateChange"})," to track the screen. If you manually control the top-level navigator (if you have integrated redux), this will not work for you."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"import { GoogleAnalyticsTracker } from 'react-native-google-analytics-bridge';\n\nconst tracker = new GoogleAnalyticsTracker(GA_TRACKING_ID);\n\n// gets the current screen from navigation state\nfunction getActiveRouteName(navigationState) {\n  if (!navigationState) {\n    return null;\n  }\n  const route = navigationState.routes[navigationState.index];\n  // dive into nested navigators\n  if (route.routes) {\n    return getActiveRouteName(route);\n  }\n  return route.routeName;\n}\n\nconst AppNavigator = createStackNavigator(AppRouteConfigs);\n\nexport default () => (\n  <AppNavigator\n    onNavigationStateChange={(prevState, currentState) => {\n      const currentScreen = getActiveRouteName(currentState);\n      const prevScreen = getActiveRouteName(prevState);\n\n      if (prevScreen !== currentScreen) {\n        // the line below uses the Google Analytics tracker\n        // change the tracker here to use other Mobile analytics SDK.\n        tracker.trackScreenView(currentScreen);\n      }\n    }}\n  />\n);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"screen-tracking-with-redux",children:"Screen tracking with Redux"}),"\n",(0,a.jsxs)(n.p,{children:["When using Redux, we can write a Redux middleware to track the screen. For this purpose,\nwe will reuse ",(0,a.jsx)(n.code,{children:"getActiveRouteName"})," from the previous section."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"import { NavigationActions } from 'react-navigation';\nimport { GoogleAnalyticsTracker } from 'react-native-google-analytics-bridge';\n\nconst tracker = new GoogleAnalyticsTracker(GA_TRACKING_ID);\n\nconst screenTracking =\n  ({ getState }) =>\n  (next) =>\n  (action) => {\n    if (\n      action.type !== NavigationActions.NAVIGATE &&\n      action.type !== NavigationActions.BACK\n    ) {\n      return next(action);\n    }\n\n    const currentScreen = getActiveRouteName(getState().navigation);\n    const result = next(action);\n    const nextScreen = getActiveRouteName(getState().navigation);\n    if (nextScreen !== currentScreen) {\n      // the line below uses the Google Analytics tracker\n      // change the tracker here to use other Mobile analytics SDK.\n      tracker.trackScreenView(nextScreen);\n    }\n    return result;\n  };\n\nexport default screenTracking;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"create-redux-store-and-apply-the-above-middleware",children:"Create Redux store and apply the above middleware"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"screenTracking"})," middleware can be applied to the store during its creation. See ",(0,a.jsx)(n.a,{href:"/docs/2.x/redux-integration",children:"Redux Integration"})," for details."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const store = createStore(\n  combineReducers({\n    navigation: navigationReducer,\n    ...\n  }),\n  applyMiddleware(\n    screenTracking,\n    ...\n    ),\n);\n"})})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(g,{...e})}):g(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var r=t(96540);const a={},i=r.createContext(a);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);