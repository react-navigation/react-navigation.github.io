"use strict";(self.webpackChunkreact_navigation_website_next=self.webpackChunkreact_navigation_website_next||[]).push([[74962],{98166:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>a,toc:()=>u});const a=JSON.parse('{"id":"redux-integration","title":"Redux integration","description":"Some folks like to have their navigation state stored in the same place as the rest of their application state. Using Redux to store your state enables you to write custom actions that manipulate the navigation state directly, to be able to dispatch navigation actions from anywhere (sometimes in a \\"thunk\\" or \\"saga\\") and to persist the navigation state in the same way you would other Redux state (your mileage may vary on this). You can read more about other use cases in the replies to this tweet.","source":"@site/versioned_docs/version-1.x/redux-integration.md","sourceDirName":".","slug":"/redux-integration","permalink":"/docs/1.x/redux-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/react-navigation/react-navigation.github.io/edit/main/versioned_docs/version-1.x/redux-integration.md","tags":[],"version":"1.x","frontMatter":{"id":"redux-integration","title":"Redux integration","sidebar_label":"Redux integration"},"sidebar":"docs","previous":{"title":"Screen tracking","permalink":"/docs/1.x/screen-tracking"},"next":{"title":"Overview","permalink":"/docs/1.x/custom-navigator-overview"}}');var r=n(74848),i=n(28453),o=n(11470),s=n(19365);const l={id:"redux-integration",title:"Redux integration",sidebar_label:"Redux integration"},c=void 0,d={},u=[{value:"Warning",id:"warning",level:2},{value:"Overview",id:"overview",level:2},{value:"Step-by-step guide",id:"step-by-step-guide",level:2},{value:"Full example",id:"full-example",level:2},{value:"Mocking tests",id:"mocking-tests",level:2},{value:"Handling the Hardware Back Button in Android",id:"handling-the-hardware-back-button-in-android",level:2}];function h(e){const t={a:"a",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:['Some folks like to have their navigation state stored in the same place as the rest of their application state. Using Redux to store your state enables you to write custom actions that manipulate the navigation state directly, to be able to dispatch navigation actions from anywhere (sometimes in a "thunk" or "saga") and to persist the navigation state in the same way you would other Redux state (your mileage may vary on this). You can read more about other use cases in the replies to ',(0,r.jsx)(t.a,{href:"https://twitter.com/satya164/status/952291726521024512",children:"this tweet"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"warning",children:"Warning"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.em,{children:"You probably do not need to do this!"})," Storing your React Navigation state in your own Redux store is likely to give you a very difficult time if you don't know what you're doing. You lose out on some performance optimizations that React Navigation can do for you, for example. Please do not integrate your state into Redux without first ensuring that you can do what you need to do without it!"]}),"\n",(0,r.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["To handle your app's navigation state in Redux, you can pass your own ",(0,r.jsx)(t.code,{children:"navigation"})," prop to a navigator."]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Once you pass your own navigation prop to the navigator, the default ",(0,r.jsx)(t.a,{href:"/docs/1.x/navigation-prop",children:(0,r.jsx)(t.code,{children:"navigation"})})," prop gets destroyed. You must construct your own ",(0,r.jsx)(t.code,{children:"navigation"})," prop with ",(0,r.jsx)(t.a,{href:"/docs/1.x/navigation-prop#state---the-screens-current-stateroute",children:(0,r.jsx)(t.code,{children:"state"})}),", ",(0,r.jsx)(t.a,{href:"/docs/1.x/navigation-prop#dispatch---send-an-action-to-the-router",children:(0,r.jsx)(t.code,{children:"dispatch"})}),", and ",(0,r.jsx)(t.code,{children:"addListener"})," properties."]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"state"})," will be fed from the reducer assigned to handle navigation state and the ",(0,r.jsx)(t.code,{children:"dispatch"})," will be Redux's default ",(0,r.jsx)(t.code,{children:"dispatch"}),". Thus you will be able to dispatch normal redux actions using ",(0,r.jsx)(t.code,{children:"this.props.navigation.dispatch(ACTION)"}),", reducer will update the navigation state on the basis of dispatched action, the new navigation state will then be passed to the navigator."]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"A middleware is needed so that any events that mutate the navigation state properly trigger the event listeners."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"step-by-step-guide",children:"Step-by-step guide"}),"\n",(0,r.jsxs)(t.p,{children:["First, you need to add the ",(0,r.jsx)(t.code,{children:"react-navigation-redux-helpers"})," package to your project."]}),"\n",(0,r.jsxs)(o.A,{groupId:"npm2yarn",children:[(0,r.jsx)(s.A,{value:"npm",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"npm install react-navigation-redux-helpers\n"})})}),(0,r.jsx)(s.A,{value:"yarn",label:"Yarn",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"yarn add react-navigation-redux-helpers\n"})})}),(0,r.jsx)(s.A,{value:"pnpm",label:"pnpm",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"pnpm add react-navigation-redux-helpers\n"})})}),(0,r.jsx)(s.A,{value:"bun",label:"Bun",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"bun add react-navigation-redux-helpers\n"})})})]}),"\n",(0,r.jsxs)(t.p,{children:["With Redux, your app's state is defined by a reducer. Each navigation router effectively has a reducer, called ",(0,r.jsx)(t.code,{children:"getStateForAction"}),". The following is a minimal example of how you might use navigators within a Redux application:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-es6",children:"import {\n  StackNavigator,\n  addNavigationHelpers,\n} from 'react-navigation';\nimport {\n  createStore,\n  applyMiddleware,\n  combineReducers,\n} from 'redux';\nimport {\n  createReduxBoundAddListener,\n  createReactNavigationReduxMiddleware,\n} from 'react-navigation-redux-helpers';\nimport { Provider, connect } from 'react-redux';\nimport React from 'react';\n\nconst AppNavigator = StackNavigator(AppRouteConfigs);\n\nconst initialState = AppNavigator.router.getStateForAction(AppNavigator.router.getActionForPathAndParams('Login'));\n\nconst navReducer = (state = initialState, action) => {\n  const nextState = AppNavigator.router.getStateForAction(action, state);\n\n  // Simply return the original `state` if `nextState` is null or undefined.\n  return nextState || state;\n};\n\nconst appReducer = combineReducers({\n  nav: navReducer,\n  ...\n});\n\n// Note: createReactNavigationReduxMiddleware must be run before createReduxBoundAddListener\nconst middleware = createReactNavigationReduxMiddleware(\n  \"root\",\n  state => state.nav,\n);\nconst addListener = createReduxBoundAddListener(\"root\");\n\nclass App extends React.Component {\n  render() {\n    return (\n      <AppNavigator navigation={addNavigationHelpers({\n        dispatch: this.props.dispatch,\n        state: this.props.nav,\n        addListener,\n      })} />\n    );\n  }\n}\n\nconst mapStateToProps = (state) => ({\n  nav: state.nav\n});\n\nconst AppWithNavigationState = connect(mapStateToProps)(App);\n\nconst store = createStore(\n  appReducer,\n  applyMiddleware(middleware),\n);\n\nclass Root extends React.Component {\n  render() {\n    return (\n      <Provider store={store}>\n        <AppWithNavigationState />\n      </Provider>\n    );\n  }\n}\n"})}),"\n",(0,r.jsx)(t.p,{children:"Once you do this, your navigation state is stored within your Redux store, at which point you can fire navigation actions using your Redux dispatch function."}),"\n",(0,r.jsxs)(t.p,{children:["Keep in mind that when a navigator is given a ",(0,r.jsx)(t.code,{children:"navigation"})," prop, it relinquishes control of its internal state. That means you are now responsible for persisting its state, handling any deep linking, ",(0,r.jsx)(t.a,{href:"#handling-the-hardware-back-button-in-android",children:"Handling the Hardware Back Button in Android"}),", etc."]}),"\n",(0,r.jsxs)(t.p,{children:["Navigation state is automatically passed down from one navigator to another when you nest them. Note that in order for a child navigator to receive the state from a parent navigator, it should be defined as a ",(0,r.jsx)(t.code,{children:"screen"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Applying this to the example above, you could instead define ",(0,r.jsx)(t.code,{children:"AppNavigator"})," to contain a nested ",(0,r.jsx)(t.code,{children:"TabNavigator"})," as follows:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-es6",children:"const AppNavigator = StackNavigator({\n  Home: { screen: MyTabNavigator },\n});\n"})}),"\n",(0,r.jsxs)(t.p,{children:["In this case, once you ",(0,r.jsx)(t.code,{children:"connect"})," ",(0,r.jsx)(t.code,{children:"AppNavigator"})," to Redux as is done in ",(0,r.jsx)(t.code,{children:"AppWithNavigationState"}),", ",(0,r.jsx)(t.code,{children:"MyTabNavigator"})," will automatically have access to navigation state as a ",(0,r.jsx)(t.code,{children:"navigation"})," prop."]}),"\n",(0,r.jsx)(t.h2,{id:"full-example",children:"Full example"}),"\n",(0,r.jsxs)(t.p,{children:["There's a working example app with Redux ",(0,r.jsx)(t.a,{href:"https://github.com/react-navigation/react-navigation/tree/1.x/examples/ReduxExample",children:"here"})," if you want to try it out yourself."]}),"\n",(0,r.jsx)(t.h2,{id:"mocking-tests",children:"Mocking tests"}),"\n",(0,r.jsxs)(t.p,{children:["To make jest tests work with your react-navigation app, you need to change the jest preset in the ",(0,r.jsx)(t.code,{children:"package.json"}),", see ",(0,r.jsx)(t.a,{href:"https://facebook.github.io/jest/docs/tutorial-react-native.html#transformignorepatterns-customization",children:"here"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'"jest": {\n  "preset": "react-native",\n  "transformIgnorePatterns": [\n    "node_modules/(?!(jest-)?react-native|react-navigation)"\n  ]\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"handling-the-hardware-back-button-in-android",children:"Handling the Hardware Back Button in Android"}),"\n",(0,r.jsx)(t.p,{children:"By using the following snippet, your nav component will be aware of the back button press actions and will correctly interact with your stack. This is really useful on Android."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-es6",children:"import React from 'react';\nimport { BackHandler } from 'react-native';\nimport { addNavigationHelpers, NavigationActions } from 'react-navigation';\n\nconst AppNavigation = TabNavigator({\n  Home: { screen: HomeScreen },\n  Settings: { screen: SettingScreen },\n});\n\nclass ReduxNavigation extends React.Component {\n  componentDidMount() {\n    BackHandler.addEventListener('hardwareBackPress', this.onBackPress);\n  }\n  componentWillUnmount() {\n    BackHandler.removeEventListener('hardwareBackPress', this.onBackPress);\n  }\n  onBackPress = () => {\n    const { dispatch, nav } = this.props;\n    if (nav.index === 0) {\n      return false;\n    }\n    dispatch(NavigationActions.back());\n    return true;\n  };\n\n  render() {\n    const { dispatch, nav } = this.props;\n    const navigation = addNavigationHelpers({\n      dispatch,\n      state: nav,\n      addListener,\n    });\n\n    return <AppNavigation navigation={navigation} />;\n  }\n}\n"})})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},19365:(e,t,n)=>{n.d(t,{A:()=>o});n(96540);var a=n(34164);const r={tabItem:"tabItem_Ymn6"};var i=n(74848);function o(e){let{children:t,hidden:n,className:o}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,a.A)(r.tabItem,o),hidden:n,children:t})}},11470:(e,t,n)=>{n.d(t,{A:()=>k});var a=n(96540),r=n(34164),i=n(17559),o=n(23104),s=n(56347),l=n(205),c=n(57485),d=n(31682),u=n(70679);function h(e){var t,n;return null!=(t=null==(n=a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:n.filter(Boolean))?t:[]}function p(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=null!=t?t:function(e){return h(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}(n);return function(e){const t=(0,d.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[t,n])}function g(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function v(e){let{queryString:t=!1,groupId:n}=e;const r=(0,s.W6)(),i=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=n?n:null}({queryString:t,groupId:n});return[(0,c.aZ)(i),(0,a.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(r.location.search);t.set(i,e),r.replace(Object.assign({},r.location,{search:t.toString()}))}),[i,r])]}function m(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,i=p(e),[o,s]=(0,a.useState)((()=>function(e){var t;let{defaultValue:n,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!g({value:n,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+n+'" but none of its children has the corresponding value. Available values are: '+a.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return n}const r=null!=(t=a.find((e=>e.default)))?t:a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:i}))),[c,d]=v({queryString:n,groupId:r}),[h,m]=function(e){let{groupId:t}=e;const n=function(e){return e?"docusaurus.tab."+e:null}(t),[r,i]=(0,u.Dv)(n);return[r,(0,a.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:r}),x=(()=>{const e=null!=c?c:h;return g({value:e,tabValues:i})?e:null})();(0,l.A)((()=>{x&&s(x)}),[x]);return{selectedValue:o,selectValue:(0,a.useCallback)((e=>{if(!g({value:e,tabValues:i}))throw new Error("Can't select invalid tab value="+e);s(e),d(e),m(e)}),[d,m,i]),tabValues:i}}var x=n(92303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=n(74848);function y(e){let{className:t,block:n,selectedValue:a,selectValue:i,tabValues:s}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,o.a_)(),d=e=>{const t=e.currentTarget,n=l.indexOf(t),r=s[n].value;r!==a&&(c(t),i(r))},u=e=>{var t;let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{var a;const t=l.indexOf(e.currentTarget)+1;n=null!=(a=l[t])?a:l[0];break}case"ArrowLeft":{var r;const t=l.indexOf(e.currentTarget)-1;n=null!=(r=l[t])?r:l[l.length-1];break}}null==(t=n)||t.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},t),children:s.map((e=>{let{value:t,label:n,attributes:i}=e;return(0,b.jsx)("li",Object.assign({role:"tab",tabIndex:a===t?0:-1,"aria-selected":a===t,ref:e=>{l.push(e)},onKeyDown:u,onClick:d},i,{className:(0,r.A)("tabs__item",f.tabItem,null==i?void 0:i.className,{"tabs__item--active":a===t}),children:null!=n?n:t}),t)}))})}function j(e){let{lazy:t,children:n,selectedValue:i}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===i));return e?(0,a.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==i})))})}function w(e){const t=m(e);return(0,b.jsxs)("div",{className:(0,r.A)(i.G.tabs.container,"tabs-container",f.tabList),children:[(0,b.jsx)(y,Object.assign({},t,e)),(0,b.jsx)(j,Object.assign({},t,e))]})}function k(e){const t=(0,x.A)();return(0,b.jsx)(w,Object.assign({},e,{children:h(e.children)}),String(t))}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>s});var a=n(96540);const r={},i=a.createContext(r);function o(e){const t=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(i.Provider,{value:t},e.children)}}}]);